<!doctype html>
<html lang="">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="idris-maps">
    <meta name="description" content="How ES6 tagged templates are used in frontend javascript librairies such as htm, hyperHTML and lit-html.">
    <meta name="keywords" content="tagged templates,template literals,template element,htm,hyperHTML,lit-html,javascript,js,es6,webcomponents">
    <meta property="og:image" content="https://idris-maps.com/assets/images/idris-maps.svg">
    <meta property="og:description" content="How ES6 tagged templates are used in frontend javascript librairies such as htm, hyperHTML and lit-html.">
    <meta property="og:title" content="Tagged templates">
    <meta name="twitter:title" content="Tagged templates">
    <title>Tagged templates</title>
    
    <style>
      *{box-sizing:border-box}@font-face{font-family:alegreyaregular;src:url(/assets/alegreya-regular-webfont.woff2) format('woff2'),url(/assets/alegreya-regular-webfont.woff) format('woff'),url(/assets/alegreya-regular-webfont.ttf) format('ttf');font-weight:400;font-style:normal}body,html{width:100%;padding:0;margin:0;font-family:alegreyaregular;color:#292929}.blog-content>.blog-date{font-size:.8em;color:#6f6969}.blog-content{width:90%;margin:auto;font-size:35px;color:#292929}.blog-content>p{text-align:justify;width:100%}.blog-content>p>img{max-width:100%;display:block;margin-left:auto;margin-right:auto}.blog-content a{color:#000;cursor:pointer}header{display:flex;flex-direction:row;align-items:center;width:90%;margin:auto;margin-top:1em}.cta-container{flex:auto;text-align:right}.logo{height:100px}.gis-cta-long,.gis-cta-short{cursor:pointer;background:#fff;color:#292929;border:2px solid #292929;font-size:1.2em;font-family:alegreyaregular}.gis-cta-long:hover,.gis-cta-short:hover{background:#292929;color:#fff;border:none}.gis-cta-long{display:inline-block;padding:.6em 1.5em .8em 1.2em}.gis-cta-short{display:none;padding:.3em .8em .4em .5em}.gis-cta-long svg{width:1.2em;position:relative;top:.2em;left:.2em}.gis-cta-short svg{width:1em;position:relative;top:.2em;left:.1em}footer{margin-top:100px;margin-bottom:100px}footer p{margin:auto;text-align:center}footer .lighter{font-size:.7em;color:#6f6969;margin-left:.3em;margin-right:.3em}.splash{display:flex;flex-flow:row wrap;width:90%;margin:auto;margin-top:100px;margin-bottom:100px}.splash-globe,.splash-text{width:50%;display:flex;align-items:center;padding:3%}.splash-text>h1{width:100%;text-align:center;font-size:9em}.splash-globe>img{width:100%}.post-list{font-size:35px;width:90%;margin:auto;max-width:1000px}.post-list a{text-decoration:none;color:inherit}.post-list-item-date{width:100%;text-align:right;font-size:.7em;color:#6f6969}.post-list-item{margin-top:5em;margin-bottom:5em;width:100%}@media (max-width:1000px){.blog-content,.post-list{font-size:27px}.blog-content code{font-size:16px}.splash-text>h1{font-size:5em}}@media (max-width:600px){.blog-content,.post-list{font-size:20px}.logo{height:80px}.blog-content code{font-size:14px}.splash-text>h1{font-size:3em}.gis-cta-long{display:none}.gis-cta-short{display:inline-block}}@media (max-width:300px){.blog-content,.post-list{font-size:14px}.logo{height:50px}.blog-content code{font-size:12px}.splash-text>h1{font-size:2em}}pre{background:#272822;padding:.8em;border-radius:.5em;font-size:.8em;overflow-x:auto}code{color:inherit;font-size:.7em;background:#f0f0f0;padding:.2em;border-radius:.2em}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
    </style>
  </head>
  <body>
    <header>
      <div class="logo-container">
        <a href="http://www.idris-maps.com">
          <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
            <g transform="matrix(.84138 0 0 .86313 49.9 51)" fill="none">
              <ellipse ry="55.6" rx="57" cy="-1.1" cx=".2" fill="gray"></ellipse>
              <path d="M-47.7-15.6c3.9-11.6 22.6-45.2 64.2-32.9A54.1 54.1 0 0 1 50.8 1.7l-2.3.5c-.4 4-.4 8.3-1.9 11.5.3 2-.8 3.1-1.7 4.4l-2 6.2c-1.5 2.2-3 3.7-4.4 4.6-2-2-2.4-4.4-2.7-6.8.4-1.3-6.6-2.8-6.2-5.8-1.6-.8-2.3.5-3.7.2.3-1-.6-1.8-2.6-2.4-2 .4.3-3-6.3-2.3-.9 0-2.2-6.5-7.5-2.4-11.4-7.8-4.6 8.2-2.4 14.9.4.8-2.1 2-.8 3.4.4.7-5 1.7-5.8 1-1.1-1.1-1.4-4-3-3.5-2.2-1.3-3-.2-3.3 1.8 0 1.7-1 2.8-1.6 4 1.3.7 3.9-.3 5.5.8.6-.7 2.1-1.4 6-1.8 3.8.1 3.2-2 4-3.6.2-2.4 3.8-3.2 4.8-6.3.3.4.5-1.2 1 3 1.3-.2.5-2.9 2-2 1.5 1.7-3.9-3.6 4.3 13.7.8 1 1 0 1.3-.2-3.6-6.3-1.9-6-2.7-8.8-1.4-1.6-.5-1.9.1-2.4 1.9.3 1.6 1.4 2 2.3.2-1.8 1.4-1 2.3-1-1 .5-1.8 1.1-1.2 2.4 1.7.1 2 1 2.8 1.6l.1 1.6c1.2.2.8-.7 1-1.1.7 1.3 2.1 0 3.4-.2 1.6.4 3 1 5.7.3 4.6.3 1.2 2.2 1.4 3.3-1.5 1.3-3 2.8-4.6 2.8-1.2-.1-3.2.8-3.5-1-.3-2.7-1.2-2.2-2.3.3-1 1.6-.8 3-1 4.4-2 2-3.4 3.2-2.8.6 0-1 1.7-2.7-1.8-2-2.2 1.1-4.4 1.6-6.5 2.2-1.2-.3-3-1.6-3.1-.3-2-1.4-3.8 1.3-5.7 2.3-4.2 1.3-9-2.9-9.5.5 0 1.2-.4 2.3 3.3 2.8 2 1.2 3 2.6 3.5 4.2-8.5.3-16.3-2.2-17.7-3.8-7.5-5.2-2.3-5.7-6.7-6.6-2.9-.8 1.7-1-4.4-2.7-2.7-.7-3.5-3.6-4.5-5.5-3.4-.2-2.3-1.8-7.1-2.3-.8-.3-3.8-3-3.5-5-.3-1.6 0-3.4-2.2-4-1.6-1 1.3-4-.5-4.4-.2 1-.3 2.5-2 1-.4-2.5.8-1.5 1.7-1.2.6-.5 0-1.1-.3-1.8-1.2-1-2.3-2-2.3-2.7A47 47 0 0 1-44-3.2c1.3-.3 1.9-.2 3.7-1.3 1.2 0 1.3.5 3.3-.9 2.5.8 5.1 1.6 8.4.4 2-1.6 2.8-5.3 6.7-3 3 1.6 3.3-1 5.2.6 1.6.4 5.3-2.9 5 1.4 1 1.3 2 1.9 2.4 4 1.7.2.3 2.4 4 6a4 4 0 0 0 2 2C-2.2.8-6.8-3.7-8.6-8.5c-2-4.5 1.8-2 3.3-2.1a7 7 0 0 1 5.8.1c1.8.2 3.9 0 3.3 3C3.4-4.7 4-2 2.4.3c-.8 1 0 1.8 1.2 2.5 1.9-.4 3.3 1.2 4.8 3 .6-.2 1-1 1.4-1.8-.3-2-1.4-2.1-2.3-2.8C6.3.5 6.4-.1 6.8-1.3 7.8-5 5-9.3 6-13c0-.7-4.4-7.6-5.6-7.6-4.9-2.6-7-2-9-1-2 .4-4.2 1.2-6-.1-3.6-.3-7-.4-10.5.7-3.9 1-8.3.6-11.5 3.4l-5.5 2c-2 .6-3.9.8-5.6.1z" fill="#e6e6e6" stroke="none"></path>
              <path d="M-43-37.4A54.6 54.6 0 0 0-57-1.1 56.3 56.3 0 0 0 0 54.5c20.3 0 38-10.3 48.1-25.8C-5.4 42.8-41 19.7-43-37.4z" opacity=".2" fill="#000" stroke="none"></path>
            </g>
          </svg>
        </a>
      </div>
      <div class="cta-container">
        <a href="https://idris-draw.surge.sh/">
          <button class="gis-cta-long">
            <span>Try the online mapping tool</span>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
            </svg>
          </button>
          <button class="gis-cta-short">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
            </svg>
          </button>
        </a>
      </div>
    </header>
    <main>
      
<div class="blog-content">
  <p class="blog-date">2019-06-07</p>
  <h1>Tagged templates</h1>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">Template literals</a> have been a part of the specs since ES2015.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token string">'We do not '</span> <span class="token operator">+</span> need <span class="token operator">+</span> <span class="token string">' to concatenate '</span> <span class="token operator">+</span> strings <span class="token operator">+</span> <span class="token string">'like this '</span> <span class="token operator">+</span> anymore<br><br><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">This </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>feels<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> much </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>smoother<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span></code></pre>
<p>Writing HTML strings in javascript was frowned upon once upon a time. It is not anymore, thanks to the popularity of react and JSX. Could we just use it to write our templates, and add it to the DOM with the good old <code>.innerHTML</code>? You could, but that has not come back in fashion yet. It probably never will.</p>
<p>There are however ways to use template literals for the DOM and they all use so called <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#Tagged_templates">tagged templates</a>:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">taggedTemplateExample</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">strings<span class="token punctuation">,</span> <span class="token operator">...</span>arguments</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> strings<span class="token punctuation">,</span> arguments <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'Bob'</span><br><span class="token keyword">const</span> object <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><br><br>taggedTemplateExample<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">My name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Here is an </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>object<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span></code></pre>
<p>returns</p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  â€‹arguments<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  strings<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"My name is "</span><span class="token punctuation">,</span> <span class="token string">". Here is an "</span><span class="token punctuation">,</span> <span class="token string">"."</span> <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>This is a bit of a stupid example but it does show how arguments and strings are passed to tagged templates. It is just a function that takes an array of strings as the first argument. That is the string inside the template, cut up at every variable. All subsequent arguments are the variables. And they do not need to be strings.</p>
<p>This opens up a lot of possibilities. <a href="https://observablehq.com/">ObservableHQ</a>, for example, makes good use of tagged templates for cells with markdown, svg or html. There are also a couple of interesting frontend libraries that use them.</p>
<h2><a href="https://www.npmjs.com/package/htm">htm</a></h2>
<blockquote>
<p><em>htm is JSX-like syntax in plain JavaScript - no transpiler necessary.</em></p>
</blockquote>
<p>It is created by the <a href="https://jasonformat.com">guy behind preact</a>. The following example is taken from his article <a href="https://jasonformat.com/wtf-is-jsx/">WTF is JSX</a>. This JSX:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">/** @jsx h */</span><br><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"foo"</span><span class="token operator">></span>Hello<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre>
<p>once it has been transpiled to javascript, looks like this:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token string">"foo"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Hello!'</span><span class="token punctuation">)</span></code></pre>
<p>The HTML looking part becomes arguments to an <code>h</code> function.</p>
<p>What <code>h</code>, does is not the problem of JSX whose job is just to parse the HTML-looking code into arguments for <code>h</code>.</p>
<p><code>htm</code> works the same way. Its a tagged template that converts the content into arguments that can be passed to <code>h</code>. Here is an example of an <code>h</code> function that just logs the arguments it gets:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> htm <span class="token keyword">from</span> <span class="token string">'htm'</span><br> <br><span class="token keyword">const</span> <span class="token function-variable function">h</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span><br> <br><span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">htm</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><br> <br>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1 id=hello>Hello world!&lt;/h1></span><span class="token template-punctuation string">`</span></span></code></pre>
<p>Result:</p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  type<span class="token operator">:</span> <span class="token string">'h1'</span><span class="token punctuation">,</span><br>  props<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Hello world!'</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>This is not very useful. Let's use preact's <code>h</code> function:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> htm <span class="token keyword">from</span> <span class="token string">'htm'</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'preact'</span><br><br><span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">htm</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><br><br><span class="token function">render</span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;App /></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span></code></pre>
<p><code>htm</code> lets you use virtual DOM libraries, such as preact, without JSX. As tagged templates are part of the javascript specs (as opposed to JSX), there is no need to use a transpiler.</p>
<h2><a href="https://github.com/WebReflection/hyperHTML">hyper(HTML)</a></h2>
<blockquote>
<p><em>The DOM Is NOT Slow, Your Abstraction Is</em></p>
</blockquote>
<p><code>hyperHTML</code> does not need an <code>h</code> function, it uses the HTML <code>&lt;template&gt;</code> tag.</p>
<p>Another template?</p>
<p>Yes, this starts getting confusing. So far we have talked about &quot;tagged templates&quot; and &quot;template literals&quot; and now the &quot;template&quot; tag. This one is part of the HTML specification. You add it to your DOM like this:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>templ<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>templ-name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>Used just like this, it will be parsed by the browser but you will not see it in your page until you explicitly clone it and append it to the body.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> template <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'templ'</span><span class="token punctuation">)</span><br><span class="token keyword">const</span> clone <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">importNode</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br><span class="token keyword">const</span> nameSpan <span class="token operator">=</span> clone<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.templ-name'</span><span class="token punctuation">)</span><br>nameSpan<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'world'</span><br>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>clone<span class="token punctuation">)</span></code></pre>
<p>That is what hyperHTML uses under the hood. The following function would create a template similar to the one above.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">Welcome</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=></span><br>  hyperHTML<span class="token punctuation">.</span><span class="token function">wire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1>Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h1></span><span class="token template-punctuation string">`</span></span></code></pre>
<p>When the name changes, the template does not need to be rerendered. Only the relevant <code>textContent</code> changes. The same template can be cloned several times. The minimal abstraction makes this approch really fast.</p>
<p>This is all very nice, you may think, but this only lets you create &quot;dumb components&quot; (in react speak). What about statefull components? Can you do that?</p>
<p>Yes you can. First you need to create a new element class by extending the generic <code>HTMLElement</code> to add a <code>setState</code> function.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">HyperElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>html <span class="token operator">=</span> <span class="token function">hyperHTML</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    flatstate<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Then extending this new element, you can create your stateful component.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">StatefulComponent</span> <span class="token keyword">extends</span> <span class="token class-name">HyperElement</span> <span class="token punctuation">{</span><br>  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br>  <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><br>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>      &lt;div><br>        &lt;input oninput=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> /><br>        &lt;p></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p><br>      &lt;/div></span><span class="token template-punctuation string">`</span></span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>It does not look very different from how you would do it in react. But without all the tooling and transpiling. What you are doing is essentially creating a <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components">webcomponent</a>.</p>
<p>Define your custom element:</p>
<pre class="language-js"><code class="language-js">customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><br>  <span class="token string">'stateful-component'</span><span class="token punctuation">,</span><br>  StatefulComponent<br><span class="token punctuation">)</span><br><br>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StatefulComponent</span><span class="token punctuation">)</span></code></pre>
<p>And use it directly in your page.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stateful-component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stateful-component</span><span class="token punctuation">></span></span></code></pre>
<p>There is also a library to render on the server, <a href="https://github.com/WebReflection/viperHTML">viperHTML</a>.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> viperHTML <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'viperhtml'</span><span class="token punctuation">)</span><br><span class="token keyword">const</span> component <span class="token operator">=</span> viperHTML<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>  &lt;input onchange=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> /><br></span><span class="token template-punctuation string">`</span></span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>Will render this:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onchange</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>return (e =<span class="token entity" title="&gt;">&amp;gt;</span> alert(e.target.value)).call(this, event)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre>
<h2><a href="https://github.com/polymer/lit-html">lit-html</a></h2>
<blockquote>
<p><em>Efficient, Expressive, Extensible HTML templates</em></p>
</blockquote>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>html<span class="token punctuation">,</span> render<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit-html'</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">myTemplate</span> <span class="token operator">=</span> <span class="token parameter">name</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p>Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p></span><span class="token template-punctuation string">`</span></span><br><br><span class="token function">render</span><span class="token punctuation">(</span><span class="token function">myTemplate</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span></code></pre>
<p>This one is very similar to hyperHTML. The main difference is that it is backed by google. Thus more likely to be widely adopted. <code>lit-html</code> is the templating language in the latest version of <a href="https://www.polymer-project.org/">Polymer</a>, their webcomponent framework.</p>
<p>There are a couple of semantic differences with hyperHTML, notably a dot in front of attributes and a <code>@</code> to add event listeners:</p>
<pre class="language-js"><code class="language-js">html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;img .src=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> /></span><span class="token template-punctuation string">`</span></span><br><br>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;button @click=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>clickHandler<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">>Click Me!&lt;/button></span><span class="token template-punctuation string">`</span></span></code></pre>
<p>For looping over elements, you can use <code>.map</code>, as in hyperHTML:</p>
<pre class="language-js"><code class="language-js">html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;ul>&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li></span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/ul></span><span class="token template-punctuation string">`</span></span></code></pre>
<p>lit-html also has a <code>repeat</code> directive to do the same. It takes an argument defining the unique id of each element of the list.</p>
<pre class="language-js"><code class="language-js">html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;ul>&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">repeat</span><span class="token punctuation">(</span><br>  items<span class="token punctuation">,</span><br>  <span class="token parameter">item</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>id<span class="token punctuation">,</span><br>  <span class="token parameter">item</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li></span><span class="token template-punctuation string">`</span></span><br><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/ul></span><span class="token template-punctuation string">`</span></span></code></pre>
<p>The purpose is the same as the <code>key</code> attribute in react: to avoid rerendering if the order changes, sortable lists for example.</p>
<p>For stateful components, there is a sister library, <a href="https://github.com/polymer/lit-element">lit-element</a> that includes lit-html and is used to create webcomponents.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">StatefulComponent</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span><br>  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span> state<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span> <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">''</span><br>  <span class="token punctuation">}</span><br>  <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><br>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p><br>      &lt;input @input=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> /></span><span class="token template-punctuation string">`</span></span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Integration with state management librairies such as redux is also pretty straight forward.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit-html'</span><br><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span><br><span class="token keyword">import</span> action <span class="token keyword">from</span> <span class="token string">'./actions'</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>  &lt;p></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p><br>  &lt;input @input=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>action<span class="token punctuation">.</span>setState<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> /><br></span><span class="token template-punctuation string">`</span></span><br><br>store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token function">App</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>If you, like me, feel the amount of tooling for frontend development has gotten out of hand, these simpler solutions should be a welcome evolution. I know what I will use for my next project...</p>

</div>
    </main>
    <footer>
      <p>info<span class="lighter">at</span>idris-maps<span class="lighter">dot</span>com</p>
    </footer>
  </body>
</html>