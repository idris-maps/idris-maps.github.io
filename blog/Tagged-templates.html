<!DOCTYPE html>
  
    <html lang="en">
      <head>
    <meta charset="utf-8">
    <meta name="author" content="Idris maps">
    <meta name="description" content="How ES6 tagged templates are used in frontend javascript librairies such as htm, hyperHTML and lit-html.">
    <meta name="keywords" content="tagged templates, template literals, template element, htm, hyperHTML, lit-html, javascript, js, es6, webcomponents">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta property="og:image" content="undefined">
    <meta property="og:description" content="How ES6 tagged templates are used in frontend javascript librairies such as htm, hyperHTML and lit-html.">
    <meta property="og:title" content="Tagged templates">
    <meta name="twitter:title" content="Tagged templates">
    <link rel="shortcut icon" href="favicon.ico">
    <title>Tagged templates</title>
    <link rel="stylesheet" type="text/css" href="../style.css">
    <link rel="stylesheet" type="text/css" href="../prism.css">
    <script type="application/ld+json">{"@type":"BlogPosting","alternativeHeadline":"How ES6 tagged templates are used in frontend javascript librairies such as htm, hyperHTML and lit-html.","articleBody":"# Tagged templates\n\n[Template literals](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals) have been a part of the specs since ES2015.\n\n```javascript\n'We do not ' + need + ' to concatenate ' + strings + 'like this ' + anymore\n\n`This ${feels} much ${smoother}`\n```\nWriting HTML strings in javascript was frowned upon once upon a time. It is not anymore, thanks to the popularity of react and JSX. Could we just use it to write our templates, and add it to the DOM with the good old `.innerHTML`? You could, but that has not come back in fashion yet. It probably never will.\n\nThere are however ways to use template literals for the DOM and they all use so called [tagged templates](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#Tagged_templates):\n\n```javascript\nconst taggedTemplateExample = (strings, ...arguments) =>\n  console.log({ strings, arguments })\n\nconst name = 'Bob'\nconst object = { foo: 1 }\n\ntaggedTemplateExample`My name is ${name}. Here is an ${object}.`\n```\n\nreturns\n\n```js\n{\n  ​arguments: [ \"Bob\", { foo: 1 } ],\n  strings: [ \"My name is \", \". Here is an \", \".\" ]\n}\n```\n\nThis is a bit of a stupid example but it does show how arguments and strings are passed to tagged templates. It is just a function that takes an array of strings as the first argument. That is the string inside the template, cut up at every variable. All subsequent arguments are the variables. And they do not need to be strings. \n\nThis opens up a lot of possibilities. [ObservableHQ](https://observablehq.com/), for example, makes good use of tagged templates for cells with markdown, svg or html. There are also a couple of interesting frontend libraries that use them.\n\n\n## [htm](https://www.npmjs.com/package/htm)\n\n> *htm is JSX-like syntax in plain JavaScript - no transpiler necessary.*\n\nIt is created by the [guy behind preact](https://jasonformat.com). The following example is taken from his article [WTF is JSX](https://jasonformat.com/wtf-is-jsx/). This JSX:\n\n\n```js\n/** @jsx h */\nconst foo = <div id=\"foo\">Hello!</div>\n```\n\nonce it has been transpiled to javascript, looks like this:\n\n```js\nconst foo = h('div', {id:\"foo\"}, 'Hello!')\n```\n\nThe HTML looking part becomes arguments to an `h` function.\n\nWhat `h`, does is not the problem of JSX whose job is just to parse the HTML-looking code into arguments for `h`.\n\n`htm` works the same way. Its a tagged template that converts the content into arguments that can be passed to `h`. Here is an example of an `h` function that just logs the arguments it gets:\n\n```js\nimport htm from 'htm'\n \nconst h = (type, props, ...children) =>\n  console.log({ type, props, children })\n \nconst html = htm.bind(h)\n \nhtml`<h1 id=hello>Hello world!</h1>`\n```\n\nResult:\n\n```js\n{\n  type: 'h1',\n  props: { id: 'hello' },\n  children: ['Hello world!']\n}\n```\n\nThis is not very useful. Let's use preact's `h` function:\n\n```js\nimport htm from 'htm'\nimport { h, render } from 'preact'\n\nconst html = htm.bind(h)\n\nrender(html`<App />`, document.body)\n```\n\n`htm` lets you use virtual DOM libraries, such as preact, without JSX. As tagged templates are part of the javascript specs (as opposed to JSX), there is no need to use a transpiler.\n\n## [hyper(HTML)](https://github.com/WebReflection/hyperHTML)\n\n> *The DOM Is NOT Slow, Your Abstraction Is*\n\n`hyperHTML` does not need an `h` function, it uses the HTML `<template>` tag.\n\nAnother template?\n\nYes, this starts getting confusing. So far we have talked about \"tagged templates\" and \"template literals\" and now the \"template\" tag. This one is part of the HTML specification. You add it to your DOM like this:\n\n```html\n<template id=\"templ\">\n  <h1>Hello <span class=\"templ-name\"></span></h1>\n</template>\n```\n\nUsed just like this, it will be parsed by the browser but you will not see it in your page until you explicitly clone it and append it to the body.\n\n```js\nconst template = document.getElementById('templ')\nconst clone = document.importNode(template.content, true)\nconst nameSpan = clone.querySelector('.templ-name')\nnameSpan.textContent = 'world'\ndocument.body.appendChild(clone)\n```\n\nThat is what hyperHTML uses under the hood. The following function would create a template similar to the one above.\n\n```js\nconst Welcome = props =>\n  hyperHTML.wire()`<h1>Hello, ${props.name}</h1>`\n```\n\nWhen the name changes, the template does not need to be rerendered. Only the relevant `textContent` changes. The same template can be cloned several times. The minimal abstraction makes this approch really fast.\n\nThis is all very nice, you may think, but this only lets you create \"dumb components\" (in react speak). What about statefull components? Can you do that?\n\nYes you can. First you need to create a new element class by extending the generic `HTMLElement` to add a `setState` function.\n\n\n```js\nclass HyperElement extends HTMLElement {\n  constructor(...args) {\n    super(...args)\n    this.html = hyperHTML.bind(this)\n  }\n  render() {}\n  setState(state) {\n    flatstate.setState.call(this, state)\n    this.render()\n  }\n}\n```\n\nThen extending this new element, you can create your stateful component.\n\n```js\nclass StatefulComponent extends HyperElement {\n  connectedCallback() {\n    this.state = {}\n    this.render()\n  }\n  onChange(e) { this.setState({ value: e.target.value }) }\n  render() {\n    return this.html`\n      <div>\n        <input oninput=${this.onChange.bind(this)} />\n        <p>${this.state.value}</p>\n      </div>`\n  }\n}\n```\n\nIt does not look very different from how you would do it in react. But without all the tooling and transpiling. What you are doing is essentially creating a [webcomponent](https://developer.mozilla.org/en-US/docs/Web/Web_Components).\n\nDefine your custom element:\n\n```js\ncustomElements.define(\n  'stateful-component',\n  StatefulComponent\n)\n\ndocument.body.appendChild(new StatefulComponent)\n```\n\nAnd use it directly in your page.\n\n```html\n<stateful-component></stateful-component>\n```\n\nThere is also a library to render on the server, [viperHTML](https://github.com/WebReflection/viperHTML).\n\n```js\nconst viperHTML = require('viperhtml')\nconst component = viperHTML`\n  <input onchange=${ e => alert(e.target.value) } />\n`\nconsole.log(component.toString())\n```\n\nWill render this:\n\n```html\n<input onchange=\"return (e =&gt; alert(e.target.value)).call(this, event)\">\n```\n\n## [lit-html](https://github.com/polymer/lit-html)\n\n> *Efficient, Expressive, Extensible HTML templates*\n\n\n```js\nimport {html, render} from 'lit-html'\n\nconst myTemplate = name => html`<p>Hello ${name}</p>`\n\nrender(myTemplate('World'), document.body)\n```\n\nThis one is very similar to hyperHTML. The main difference is that it is backed by google. Thus more likely to be widely adopted. `lit-html` is the templating language in the latest version of [Polymer](https://www.polymer-project.org/), their webcomponent framework.\n\nThere are a couple of semantic differences with hyperHTML, notably a dot in front of attributes and a `@` to add event listeners:\n\n\n```js\nhtml`<img .src=${src} />`\n\nhtml`<button @click=${clickHandler}>Click Me!</button>`\n```\n\nFor looping over elements, you can use `.map`, as in hyperHTML:\n\n```js\nhtml`<ul><${items.map(item => html`<li>${item}</li>`}</ul>`\n```\n\nlit-html also has a `repeat` directive to do the same. It takes an argument defining the unique id of each element of the list.\n\n```js\nhtml`<ul><${repeat(\n  items,\n  item => item.id,\n  item => html`<li>${item}</li>`\n)}</ul>`\n```\n\nThe purpose is the same as the `key` attribute in react: to avoid rerendering if the order changes, sortable lists for example.\n\nFor stateful components, there is a sister library, [lit-element](https://github.com/polymer/lit-element) that includes lit-html and is used to create webcomponents.\n\n```js\nclass StatefulComponent extends LitElement {\n  static get properties() {\n    return { state: { type: String } }\n  }\n  constructor() {\n    super()\n    this.state = ''\n  }\n  onChange(e) { this.state = e.target.value }\n  render() {\n    return html`<p>${this.state}</p>\n      <input @input=${this.onChange} />`\n  }\n}\n```\n\nIntegration with state management librairies such as redux is also pretty straight forward.\n\n```js\nimport { html, render } from 'lit-html'\nimport store from './store'\nimport action from './actions'\n\nconst App = state => html`\n  <p>${state}</p>\n  <input @input=${action.setState} />\n`\n\nstore.subscribe(() =>\n  render(App(store.getState(), document.body)))\n```\n\nIf you, like me, feel the amount of tooling for frontend development has gotten out of hand, these simpler solutions should be a welcome evolution. I know what I will use for my next project...\n","author":{"@type":"Person","name":"Idris maps","url":"http://idris-maps.com/","sameAs":["https://github.com/idris-maps","https://medium.com/@idris.maps","https://observablehq.com/@idris-maps","https://twitter.com/idrismaps","https://www.npmjs.com/~idris-maps"]},"dateCreated":"2019-06-07","dateModified":"2019-06-07","datePublished":"2019-06-07","headline":"Tagged templates","inLanguage":"en","keywords":["tagged templates","template literals","template element","htm","hyperHTML","lit-html","javascript","js","es6","webcomponents"],"mainEntityOfPage":"True","url":"http://www.idris-maps.com/Tagged-templates"}</script>
  </head>
      <body>
        <header>
    <a href="http://www.idris-maps.com">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
        <g transform="matrix(.84138 0 0 .86313 49.9 51)" fill="none">
          <ellipse ry="55.6" rx="57" cy="-1.1" cx=".2" fill="gray"/>
          <path d="M-47.7-15.6c3.9-11.6 22.6-45.2 64.2-32.9A54.1 54.1 0 0 1 50.8 1.7l-2.3.5c-.4 4-.4 8.3-1.9 11.5.3 2-.8 3.1-1.7 4.4l-2 6.2c-1.5 2.2-3 3.7-4.4 4.6-2-2-2.4-4.4-2.7-6.8.4-1.3-6.6-2.8-6.2-5.8-1.6-.8-2.3.5-3.7.2.3-1-.6-1.8-2.6-2.4-2 .4.3-3-6.3-2.3-.9 0-2.2-6.5-7.5-2.4-11.4-7.8-4.6 8.2-2.4 14.9.4.8-2.1 2-.8 3.4.4.7-5 1.7-5.8 1-1.1-1.1-1.4-4-3-3.5-2.2-1.3-3-.2-3.3 1.8 0 1.7-1 2.8-1.6 4 1.3.7 3.9-.3 5.5.8.6-.7 2.1-1.4 6-1.8 3.8.1 3.2-2 4-3.6.2-2.4 3.8-3.2 4.8-6.3.3.4.5-1.2 1 3 1.3-.2.5-2.9 2-2 1.5 1.7-3.9-3.6 4.3 13.7.8 1 1 0 1.3-.2-3.6-6.3-1.9-6-2.7-8.8-1.4-1.6-.5-1.9.1-2.4 1.9.3 1.6 1.4 2 2.3.2-1.8 1.4-1 2.3-1-1 .5-1.8 1.1-1.2 2.4 1.7.1 2 1 2.8 1.6l.1 1.6c1.2.2.8-.7 1-1.1.7 1.3 2.1 0 3.4-.2 1.6.4 3 1 5.7.3 4.6.3 1.2 2.2 1.4 3.3-1.5 1.3-3 2.8-4.6 2.8-1.2-.1-3.2.8-3.5-1-.3-2.7-1.2-2.2-2.3.3-1 1.6-.8 3-1 4.4-2 2-3.4 3.2-2.8.6 0-1 1.7-2.7-1.8-2-2.2 1.1-4.4 1.6-6.5 2.2-1.2-.3-3-1.6-3.1-.3-2-1.4-3.8 1.3-5.7 2.3-4.2 1.3-9-2.9-9.5.5 0 1.2-.4 2.3 3.3 2.8 2 1.2 3 2.6 3.5 4.2-8.5.3-16.3-2.2-17.7-3.8-7.5-5.2-2.3-5.7-6.7-6.6-2.9-.8 1.7-1-4.4-2.7-2.7-.7-3.5-3.6-4.5-5.5-3.4-.2-2.3-1.8-7.1-2.3-.8-.3-3.8-3-3.5-5-.3-1.6 0-3.4-2.2-4-1.6-1 1.3-4-.5-4.4-.2 1-.3 2.5-2 1-.4-2.5.8-1.5 1.7-1.2.6-.5 0-1.1-.3-1.8-1.2-1-2.3-2-2.3-2.7A47 47 0 0 1-44-3.2c1.3-.3 1.9-.2 3.7-1.3 1.2 0 1.3.5 3.3-.9 2.5.8 5.1 1.6 8.4.4 2-1.6 2.8-5.3 6.7-3 3 1.6 3.3-1 5.2.6 1.6.4 5.3-2.9 5 1.4 1 1.3 2 1.9 2.4 4 1.7.2.3 2.4 4 6a4 4 0 0 0 2 2C-2.2.8-6.8-3.7-8.6-8.5c-2-4.5 1.8-2 3.3-2.1a7 7 0 0 1 5.8.1c1.8.2 3.9 0 3.3 3C3.4-4.7 4-2 2.4.3c-.8 1 0 1.8 1.2 2.5 1.9-.4 3.3 1.2 4.8 3 .6-.2 1-1 1.4-1.8-.3-2-1.4-2.1-2.3-2.8C6.3.5 6.4-.1 6.8-1.3 7.8-5 5-9.3 6-13c0-.7-4.4-7.6-5.6-7.6-4.9-2.6-7-2-9-1-2 .4-4.2 1.2-6-.1-3.6-.3-7-.4-10.5.7-3.9 1-8.3.6-11.5 3.4l-5.5 2c-2 .6-3.9.8-5.6.1z" fill="#e6e6e6" stroke="none"/>
          <path d="M-43-37.4A54.6 54.6 0 0 0-57-1.1 56.3 56.3 0 0 0 0 54.5c20.3 0 38-10.3 48.1-25.8C-5.4 42.8-41 19.7-43-37.4z" opacity=".2" fill="#000" stroke="none"/>
        </g>
      </svg>
    </a>
  </header>
        
  <div class="blog-content">
  <p class="blog-date">2019-06-07</p>
  <h1 id="tagged-templates">Tagged templates</h1>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">Template literals</a> have been a part of the specs since ES2015.</p>
<pre><code class="language-javascript"><span class="token string">'We do not '</span> <span class="token operator">+</span> need <span class="token operator">+</span> <span class="token string">' to concatenate '</span> <span class="token operator">+</span> strings <span class="token operator">+</span> <span class="token string">'like this '</span> <span class="token operator">+</span> anymore

<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">This </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>feels<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> much </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>smoother<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
</code></pre>

<p>Writing HTML strings in javascript was frowned upon once upon a time. It is not anymore, thanks to the popularity of react and JSX. Could we just use it to write our templates, and add it to the DOM with the good old <code>.innerHTML</code>? You could, but that has not come back in fashion yet. It probably never will.</p>
<p>There are however ways to use template literals for the DOM and they all use so called <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#Tagged_templates">tagged templates</a>:</p>
<pre><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">taggedTemplateExample</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">strings<span class="token punctuation">,</span> <span class="token operator">...</span>arguments</span><span class="token punctuation">)</span> <span class="token operator">=></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> strings<span class="token punctuation">,</span> arguments <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'Bob'</span>
<span class="token keyword">const</span> object <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>

taggedTemplateExample<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">My name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Here is an </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>object<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span>
</code></pre>


<p>returns</p>
<pre><code class="language-js"><span class="token punctuation">{</span>
  ​arguments<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  strings<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"My name is "</span><span class="token punctuation">,</span> <span class="token string">". Here is an "</span><span class="token punctuation">,</span> <span class="token string">"."</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>


<p>This is a bit of a stupid example but it does show how arguments and strings are passed to tagged templates. It is just a function that takes an array of strings as the first argument. That is the string inside the template, cut up at every variable. All subsequent arguments are the variables. And they do not need to be strings. </p>
<p>This opens up a lot of possibilities. <a href="https://observablehq.com/">ObservableHQ</a>, for example, makes good use of tagged templates for cells with markdown, svg or html. There are also a couple of interesting frontend libraries that use them.</p>
<h2 id="htm"><a href="https://www.npmjs.com/package/htm">htm</a></h2>
<blockquote>
<p><em>htm is JSX-like syntax in plain JavaScript - no transpiler necessary.</em></p>
</blockquote>
<p>It is created by the <a href="https://jasonformat.com">guy behind preact</a>. The following example is taken from his article <a href="https://jasonformat.com/wtf-is-jsx/">WTF is JSX</a>. This JSX:</p>
<pre><code class="language-js"><span class="token comment">/** @jsx h */</span>
<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"foo"</span><span class="token operator">></span>Hello<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
</code></pre>


<p>once it has been transpiled to javascript, looks like this:</p>
<pre><code class="language-js"><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>id<span class="token punctuation">:</span><span class="token string">"foo"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Hello!'</span><span class="token punctuation">)</span>
</code></pre>


<p>The HTML looking part becomes arguments to an <code>h</code> function.</p>
<p>What <code>h</code>, does is not the problem of JSX whose job is just to parse the HTML-looking code into arguments for <code>h</code>.</p>
<p><code>htm</code> works the same way. Its a tagged template that converts the content into arguments that can be passed to <code>h</code>. Here is an example of an <code>h</code> function that just logs the arguments it gets:</p>
<pre><code class="language-js"><span class="token keyword">import</span> htm <span class="token keyword">from</span> <span class="token string">'htm'</span>

<span class="token keyword">const</span> <span class="token function-variable function">h</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token operator">=></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">htm</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>

html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1 id=hello>Hello world!&lt;/h1></span><span class="token template-punctuation string">`</span></span>
</code></pre>


<p>Result:</p>
<pre><code class="language-js"><span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">'h1'</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  children<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Hello world!'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>


<p>This is not very useful. Let&#39;s use preact&#39;s <code>h</code> function:</p>
<pre><code class="language-js"><span class="token keyword">import</span> htm <span class="token keyword">from</span> <span class="token string">'htm'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'preact'</span>

<span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">htm</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>

<span class="token function">render</span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;App /></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
</code></pre>


<p><code>htm</code> lets you use virtual DOM libraries, such as preact, without JSX. As tagged templates are part of the javascript specs (as opposed to JSX), there is no need to use a transpiler.</p>
<h2 id="hyperhtml"><a href="https://github.com/WebReflection/hyperHTML">hyper(HTML)</a></h2>
<blockquote>
<p><em>The DOM Is NOT Slow, Your Abstraction Is</em></p>
</blockquote>
<p><code>hyperHTML</code> does not need an <code>h</code> function, it uses the HTML <code>&lt;template&gt;</code> tag.</p>
<p>Another template?</p>
<p>Yes, this starts getting confusing. So far we have talked about &quot;tagged templates&quot; and &quot;template literals&quot; and now the &quot;template&quot; tag. This one is part of the HTML specification. You add it to your DOM like this:</p>
<pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>templ<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Hello <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>templ-name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
</code></pre>


<p>Used just like this, it will be parsed by the browser but you will not see it in your page until you explicitly clone it and append it to the body.</p>
<pre><code class="language-js"><span class="token keyword">const</span> template <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'templ'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> clone <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">importNode</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> nameSpan <span class="token operator">=</span> clone<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.templ-name'</span><span class="token punctuation">)</span>
nameSpan<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'world'</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>clone<span class="token punctuation">)</span>
</code></pre>


<p>That is what hyperHTML uses under the hood. The following function would create a template similar to the one above.</p>
<pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">Welcome</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=></span>
  hyperHTML<span class="token punctuation">.</span><span class="token function">wire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1>Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h1></span><span class="token template-punctuation string">`</span></span>
</code></pre>


<p>When the name changes, the template does not need to be rerendered. Only the relevant <code>textContent</code> changes. The same template can be cloned several times. The minimal abstraction makes this approch really fast.</p>
<p>This is all very nice, you may think, but this only lets you create &quot;dumb components&quot; (in react speak). What about statefull components? Can you do that?</p>
<p>Yes you can. First you need to create a new element class by extending the generic <code>HTMLElement</code> to add a <code>setState</code> function.</p>
<pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">HyperElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>html <span class="token operator">=</span> <span class="token function">hyperHTML</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flatstate<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>


<p>Then extending this new element, you can create your stateful component.</p>
<pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">StatefulComponent</span> <span class="token keyword">extends</span> <span class="token class-name">HyperElement</span> <span class="token punctuation">{</span>
  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;div>
        &lt;input oninput=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> />
        &lt;p></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p>
      &lt;/div></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>


<p>It does not look very different from how you would do it in react. But without all the tooling and transpiling. What you are doing is essentially creating a <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components">webcomponent</a>.</p>
<p>Define your custom element:</p>
<pre><code class="language-js">customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span>
  <span class="token string">'stateful-component'</span><span class="token punctuation">,</span>
  StatefulComponent
<span class="token punctuation">)</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StatefulComponent</span><span class="token punctuation">)</span>
</code></pre>


<p>And use it directly in your page.</p>
<pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stateful-component</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stateful-component</span><span class="token punctuation">></span></span>
</code></pre>


<p>There is also a library to render on the server, <a href="https://github.com/WebReflection/viperHTML">viperHTML</a>.</p>
<pre><code class="language-js"><span class="token keyword">const</span> viperHTML <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'viperhtml'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> component <span class="token operator">=</span> viperHTML<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  &lt;input onchange=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> />
</span><span class="token template-punctuation string">`</span></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>


<p>Will render this:</p>
<pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onchange</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>return (e =<span class="token entity" title="&gt;">&amp;gt;</span> alert(e.target.value)).call(this, event)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
</code></pre>


<h2 id="lit-html"><a href="https://github.com/polymer/lit-html">lit-html</a></h2>
<blockquote>
<p><em>Efficient, Expressive, Extensible HTML templates</em></p>
</blockquote>
<pre><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>html<span class="token punctuation">,</span> render<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit-html'</span>

<span class="token keyword">const</span> <span class="token function-variable function">myTemplate</span> <span class="token operator">=</span> <span class="token parameter">name</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p>Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p></span><span class="token template-punctuation string">`</span></span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token function">myTemplate</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
</code></pre>


<p>This one is very similar to hyperHTML. The main difference is that it is backed by google. Thus more likely to be widely adopted. <code>lit-html</code> is the templating language in the latest version of <a href="https://www.polymer-project.org/">Polymer</a>, their webcomponent framework.</p>
<p>There are a couple of semantic differences with hyperHTML, notably a dot in front of attributes and a <code>@</code> to add event listeners:</p>
<pre><code class="language-js">html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;img .src=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> /></span><span class="token template-punctuation string">`</span></span>

html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;button @click=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>clickHandler<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">>Click Me!&lt;/button></span><span class="token template-punctuation string">`</span></span>
</code></pre>


<p>For looping over elements, you can use <code>.map</code>, as in hyperHTML:</p>
<pre><code class="language-js">html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;ul>&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li></span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/ul></span><span class="token template-punctuation string">`</span></span>
</code></pre>


<p>lit-html also has a <code>repeat</code> directive to do the same. It takes an argument defining the unique id of each element of the list.</p>
<pre><code class="language-js">html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;ul>&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">repeat</span><span class="token punctuation">(</span>
  items<span class="token punctuation">,</span>
  <span class="token parameter">item</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
  <span class="token parameter">item</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/ul></span><span class="token template-punctuation string">`</span></span>
</code></pre>


<p>The purpose is the same as the <code>key</code> attribute in react: to avoid rerendering if the order changes, sortable lists for example.</p>
<p>For stateful components, there is a sister library, <a href="https://github.com/polymer/lit-element">lit-element</a> that includes lit-html and is used to create webcomponents.</p>
<pre><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">StatefulComponent</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> state<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
  <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p>
      &lt;input @input=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> /></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>


<p>Integration with state management librairies such as redux is also pretty straight forward.</p>
<pre><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit-html'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>
<span class="token keyword">import</span> action <span class="token keyword">from</span> <span class="token string">'./actions'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  &lt;p></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p>
  &lt;input @input=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>action<span class="token punctuation">.</span>setState<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> />
</span><span class="token template-punctuation string">`</span></span>

store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token function">App</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>


<p>If you, like me, feel the amount of tooling for frontend development has gotten out of hand, these simpler solutions should be a welcome evolution. I know what I will use for my next project...</p>

  </div>

        <footer>
    <p>info<span class="lighter">at</span>idris-maps<span class="lighter">dot</span>com</p>
  </footer>
      </body>
    </html>